# IP_camera_panoramic

Работа с камерой Xiaomi Dafang.  
Данная камера в стоке снимает видео. Мы использовали ее необычным способом. Делаем кадр, сдвигаем мотор, делаем кадр, вырезаем пиксели в середине кадра и так пока не будет готово фото.  
Для реализации этой задачи мы использовали SDK для System on chip Ingenic T10-T20.(https://github.com/Dafang-Hacks/Ingenic-T10_20)  
Из этого SDK использовались:  
- toolchain для кросс-компиляции исходных файлов;  
- libmp, которая содержит функции для управления фото-сенсором, энкодером и декодером;  
- драйвер мотора для управления им;  
- библиотека libjpeg, которую необходимо скомпилировать под mips32. Она нужна для кодирования изображения в формат jpeg.  
  
Моя задача состояла в реализации общения процесса изображения с процессом, отправляющим команду мотору.  
Мною была выбрала технология межпроцессной коммуникации message queue. Так же было решено представить статическую библиотеку с набором функций в виде api.  
  
Библиотека включает в себя такие функции как:  
- подключиться к очереди;  
- послать сообщение о калибровки;  
- послать сообщение с шагом;  
- послать сообщение о завершении работы.  
Функции калибровки и шага возвращают усхеп, либо невалидное значение action.  

Реолизация демона общения с мотором:  
Принимающая функция ждет структуру с действием. Так же данная структура содержит номер сообщения. Это небходимо для дальнейшей проверки. Действие (например) калибровка. Суть калибровки - вернуть камеру в крайнее левое положение.  Функция калибровки заполняет структуру для отправки драйверу мотору посредством вызова ioctl. После отправки команды мотору, процесс формирует стуктуру, в которой помещает выполненное действие, номер сообщения, с которым он получил команду, и текущее положение мотора. Библиотечная функция принимает это сообщение, обрабатывает, в случае совпадения действия и номера сообщения возвращает успех.  
Реализация функции шаг аналогична, за исключением отправки финального события, при достижении максимального положения мотора, о чем так же вызывающая функция отчитывается возвратом.  
